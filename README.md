# Azure Monitor Action Group

Create an action group in Azure Monitor that can be used to configure how alerts are handled.

- [Azure Monitor Action Group](#azure-monitor-action-group)
  - [Example](#example)
  - [Required Inputs](#required-inputs)
    - [ display\_name](#-display_name)
    - [ name](#-name)
    - [ resource\_group](#-resource_group)
  - [Optional Inputs](#optional-inputs)
    - [ expiration\_days](#-expiration_days)
    - [ optional\_tags](#-optional_tags)
  - [Outputs](#outputs)
    - [ id](#-id)
  - [Resources](#resources)
  - [Requirements](#requirements)
  - [Providers](#providers)
  - [Modules](#modules)
    - [ name](#-name-1)
  - [Update Docs](#update-docs)

<!-- BEGIN_TF_DOCS -->
# Azure Monitor Action Group Module

This Terraform module creates and manages an Azure Monitor Action Group, which defines
a collection of notification preferences used by Azure Monitor alerts and service health
alerts.

## Overview

Azure Monitor Action Groups enable you to define reusable collections of notification
actions that can be triggered when alerts are fired. This module provides a standardized
way to create action groups with consistent naming and tagging conventions.

## Features

- **Standardized Naming**: Automatically generates resource names following organizational
  standards using the terraform-terraform-namer module
- **Automatic Tagging**: Applies consistent tags including environment, location, contact,
  and custom tags
- **Resource Group Integration**: Deploys into existing resource groups with location
  inheritance
- **Short Name Validation**: Ensures display names meet Azure's 12-character limit
- **Flexible Configuration**: Supports custom display names and optional tags

## Resources Created

This module creates the following Azure resources:

- **Azure Monitor Action Group** (`azurerm_monitor_action_group.main`)
  - Name format: `ag-{resource_suffix}` (where resource\_suffix is generated by the namer module)
  - Configured with provided display name (short\_name)
  - Tagged with standardized metadata

## Dependencies

This module depends on:

- **terraform-terraform-namer**: Local module for generating standardized resource names
  and tags. Must be available at `../terraform-terraform-namer`
- **AzureRM Provider**: Requires Azure Resource Manager provider to be configured
- **Existing Resource Group**: Requires a pre-existing Azure resource group

## Usage Example

```hcl
module "action_group" {
  source = "./terraform-azurerm-action-group"

  display_name   = "CriticalOps"
  resource_group = azurerm_resource_group.monitoring

  name = {
    contact     = "ops@example.com"
    environment = "prd"
    instance    = 1
    program     = "monitoring"
    repository  = "terraform-azurerm-action-group"
    workload    = "alerts"
  }

  optional_tags = {
    CostCenter = "IT-OPS"
    Criticality = "High"
  }
}
```

## Naming Convention

The module generates resource names following this pattern:
- Action Group: `ag-{environment}-{location}-{workload}-{instance}`

Example: `ag-prd-cus-alerts-001`

## Tagging Strategy

All resources are tagged with:
- **Contact**: Email address of the responsible team/person
- **Environment**: Environment designation (dev, stg, prd, etc.)
- **Location**: Azure region abbreviation
- **Program**: Program or project name
- **Repository**: Source repository name
- **Workload**: Workload or application name
- **CreateDate**: Resource creation timestamp
- **EndDate**: Calculated expiration date
- Custom tags from `optional_tags` variable

## Validation

The module includes input validation for:
- **display\_name**: Must be between 1 and 12 characters (Azure requirement)
- **expiration\_days**: Must be greater than zero

## Best Practices

1. Use descriptive display names that clearly identify the action group's purpose
2. Keep display names under 12 characters due to Azure limitations
3. Define action groups at the monitoring or shared services level
4. Use consistent naming patterns across environments
5. Tag resources appropriately for cost tracking and governance
6. Document the purpose and scope of each action group

## Limitations

- Display name (short\_name) is limited to 12 characters by Azure
- This module creates the action group structure but does not configure receivers
  (email, SMS, webhook, etc.). Receivers should be added separately.

## Further Configuration

After creating the action group, you may want to:
- Add email, SMS, or webhook receivers
- Configure Azure Functions or Logic Apps as action endpoints
- Associate the action group with alert rules
- Set up notification throttling

## Related Modules

- `terraform-terraform-namer`: Naming and tagging standardization
- `terraform-azurerm-diagnostics`: Diagnostic settings for monitoring

---

## Example

```hcl
locals {
  location       = "centralus"
  tags           = module.name.tags
  test_namespace = random_pet.instance_id.id
}

data "azurerm_client_config" "current" {}

resource "random_pet" "instance_id" {}

resource "azurerm_resource_group" "example" {
  location = local.location
  name     = "rg-${local.test_namespace}"
  tags     = local.tags
}

module "example" {
  source = "../.."

  display_name   = "DoNothing"
  resource_group = azurerm_resource_group.example

  name = {
    contact     = "nobody@dell.org"
    environment = "sbx"
    instance    = 0
    program     = "dyl"
    repository  = "terraform-azurerm-action-group"
    workload    = "apps"
  }
}
```

## Required Inputs

The following input variables are required:

### <a name="input_display_name"></a> [display\_name](#input\_display\_name)

Description: The display name of the action group.

Type: `string`

### <a name="input_name"></a> [name](#input\_name)

Description: The name tokens used to construct the resource name and tags.

Type:

```hcl
object({
    contact     = string
    environment = string
    instance    = optional(number)
    program     = optional(string)
    repository  = string
    workload    = string
  })
```

### <a name="input_resource_group"></a> [resource\_group](#input\_resource\_group)

Description: The resource group to deploy resources into

Type:

```hcl
object({
    location = string
    name     = string
  })
```

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_expiration_days"></a> [expiration\_days](#input\_expiration\_days)

Description: Used to calculate the value of the EndDate tag by adding the specified number of days to the CreateDate tag.

Type: `number`

Default: `365`

### <a name="input_optional_tags"></a> [optional\_tags](#input\_optional\_tags)

Description: A map of additional tags for the resource.

Type: `map(string)`

Default: `{}`

## Outputs

The following outputs are exported:

### <a name="output_id"></a> [id](#output\_id)

Description: The ID of the Action Group.

## Resources

The following resources are used by this module:

- [azurerm_monitor_action_group.main](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_action_group) (resource)

## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (~> 1.3)

- <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) (~> 3.41)

## Providers

The following providers are used by this module:

- <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) (3.117.1)

## Modules

The following Modules are called:

### <a name="module_name"></a> [name](#module\_name)

Source: ../terraform-terraform-namer

Version:
<!-- END_TF_DOCS -->

## <a name='update-docs'></a>Update Docs

Run this command:

```
terraform-docs markdown document --output-file README.md --output-mode inject .
```